CREATE DATABASE ENJOY_GALAXY;
USE ENJOY_GALAXY;
CREATE TABLE USER (
	ID BIGINT AUTO_INCREMENT PRIMARY KEY,
    TYPE VARCHAR(20) NOT NULL,
    FULLNAME VARCHAR(50) NOT NULL,
    PHONE_NUMBER VARCHAR(10) UNIQUE NOT NULL,
    EMAIL VARCHAR(50) UNIQUE NOT NULL,
    PASSWORD VARCHAR(20) NOT NULL,
    WALLET DOUBLE CONSTRAINT CHECK_WALLET CHECK (WALLET >= 0),
    EDUCATION VARCHAR(50),
    JOBTITLE VARCHAR(50),
    SALARY DOUBLE CONSTRAINT CHECK_SALARY CHECK (SALARY >= 0),
    BIRTHDAY DATE,
    ADDRESS VARCHAR(300)
);
CREATE TABLE MOVIE (
	ID BIGINT AUTO_INCREMENT PRIMARY KEY,
    NAME VARCHAR(200) UNIQUE NOT NULL,
    DIRECTOR VARCHAR(100),
    ACTORS VARCHAR(500),
    GENRE VARCHAR(100),
    PREMIERE_DATE DATE,
    DURATION INT CONSTRAINT CHECK_DURATION CHECK (DURATION > 0),
    LANGUAGE VARCHAR(100),
    CONTENT VARCHAR(1000)
);
CREATE TABLE MOVIE_THEATER (
	ID BIGINT AUTO_INCREMENT PRIMARY KEY,
    TYPE VARCHAR(50) NOT NULL,
    NAME VARCHAR(100) UNIQUE NOT NULL,
    ADDRESS VARCHAR(200) UNIQUE NOT NULL
);
CREATE TABLE CINEMA (
	ID BIGINT AUTO_INCREMENT PRIMARY KEY,
    TYPE VARCHAR(50) NOT NULL,
    NAME VARCHAR(100) NOT NULL,
    NUMBER_ROW_SEAT INT DEFAULT 4 CHECK (NUMBER_ROW_SEAT > 0),
    NUMBER_COLUMN_SEAT INT DEFAULT 4 CHECK (NUMBER_COLUMN_SEAT > 0),
    ID_MOVIE_THEATER BIGINT NOT NULL,
    FOREIGN KEY (ID_MOVIE_THEATER) REFERENCES MOVIE_THEATER(ID)
);
CREATE TABLE SHOWTIME (
	ID BIGINT AUTO_INCREMENT PRIMARY KEY,
    START_TIME DATETIME NOT NULL,
    END_TIME DATETIME,
    ID_CINEMA BIGINT NOT NULL,
    FOREIGN KEY (ID_CINEMA) REFERENCES CINEMA(ID),
    ID_MOVIE BIGINT NOT NULL,
    FOREIGN KEY (ID_MOVIE) REFERENCES MOVIE(ID)
);
CREATE TABLE SEAT (
	ID BIGINT AUTO_INCREMENT PRIMARY KEY,
    TYPE VARCHAR(50) NOT NULL,
    CODE VARCHAR(3),
    READY BIT DEFAULT 1,
    ID_SHOWTIME BIGINT,
    FOREIGN KEY (ID_SHOWTIME) REFERENCES SHOWTIME(ID)
);
CREATE TABLE TICKET (
	ID BIGINT AUTO_INCREMENT PRIMARY KEY,
    PRICE DOUBLE NOT NULL CHECK (PRICE > 0),
    ID_USER BIGINT,
    FOREIGN KEY (ID_USER) REFERENCES USER(ID),
    ID_SEAT BIGINT,
    FOREIGN KEY (ID_SEAT) REFERENCES SEAT(ID),
    TIME_BOOKING DATETIME NOT NULL,
    PAID BIT DEFAULT 0,
    TIME_PAYMENT DATETIME,
    CHECKED BIT DEFAULT 0
);
INSERT INTO USER(TYPE, FULLNAME, PHONE_NUMBER, EMAIL, PASSWORD, WALLET) VALUES ("ADMIN", "Đoàn Hưởng", "0888442448",  "huong@gmail.com", "123", "1000000");
INSERT INTO MOVIE_THEATER(TYPE, NAME, ADDRESS) VALUES 
("STANDARD", "EG Hùng Vương", "126 Hồng Bàng, Phường 12, Quận 5"),
("STANDARD", "EG Hoàng Văn Thụ", "415, Hoàng Văn Thụ, Phường 2, Quận Tân Bình"),
("STANDARD", "EG Sư Vạn Hạnh", "11 Sư Vạn Hạnh, Phường 12, Quận 10"),
("STANDARD", "EG Đồng Khởi", "72 Lê Thánh Tôn & 45A Lý Tự Trọng, Quận 1"),
("STANDARD", "EG Thủ Đức", "216 Võ Văn Ngân, Phường Bình Thọ, Quận Thủ Đức");
